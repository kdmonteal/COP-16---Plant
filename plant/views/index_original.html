<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puntos de Interés en Modelo 3D - USB</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

  <!-- Model Viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <!-- CSS personalizados -->
  <link rel="stylesheet" href="../src/css/index_invernadero.css">
  <link rel="stylesheet" href="../src/css/model_viewer_style.css">

  <style>
    body {
      font-family: 'Fredoka', sans-serif;
      background-color: #f8f9fa;
      color: #333;
    }

    header {
      background: linear-gradient(90deg, #004b8d, #007bff);
      color: white;
      padding: 1rem 0;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    header img {
      width: 180px;
    }

    model-viewer {
      width: 100%;
      height: 70vh;
      background-color: #fff;
      border-radius: 1rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      margin-top: 2rem;
    }

    .slider {
      display: flex;
      justify-content: center;
      gap: 0.8rem;
      margin: 1.5rem 0;
      flex-wrap: wrap;
    }

    .slide {
      width: 80px;
      height: 80px;
      background-size: cover;
      background-position: center;
      border: 3px solid transparent;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    }

    .slide:hover {
      transform: scale(1.08);
      border-color: #007bff;
    }

    .slide.selected {
      border-color: #007bff;
      transform: scale(1.1);
    }

    .card {
      border: none;
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      padding: 1.5rem;
      background-color: #fff;
    }

    .btn-round {
      border-radius: 50%;
      width: 42px;
      height: 42px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    #result,
    #resultVariables,
    #resultGPT {
      background: #f0f4ff;
      border-radius: 1rem;
      padding: 1rem;
      margin-top: 1rem;
      text-align: left;
      font-weight: 500;
      min-height: 2.5rem;
    }

    footer {
      background-color: #f1f1f1;
      text-align: center;
      padding: 1rem;
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <a href="../index.html">
      <img src="../src/img/logo_cop_usb.png" alt="Logo Universidad de San Buenaventura">
    </a>
    <h3 class="mt-2 fw-light">Predicción de Supervivencia del Frijol - Modelo 3D</h3>
  </header>

  <!-- MODEL VIEWER -->
  <div class="container mt-4">
    <model-viewer id="plantViewer" src="../src/bean/Frijol_0.glb" alt="Modelo 3D de una planta" auto-rotate camera-controls
      camera-orbit="45deg 55deg 4m" scale="0.2 0.2 0.2" ar ar-modes="webxr scene-viewer quick-look" exposure="0.7"
      shadow-intensity="1" shadow-softness="1">
    </model-viewer>

    <!-- SLIDER -->
    <div id="menuEtapas" class="slider">
      <button class="slide selected" onclick="switchSrc(this, 'bean/Frijol_0')"
        style="background-image: url('../src/img/steps/1.png');"></button>
      <button class="slide" onclick="switchSrc(this, 'bean/Frijol_1')"
        style="background-image: url('../src/img/steps/3.png');"></button>
      <button class="slide" onclick="switchSrc(this, 'bean/Frijol_2')"
        style="background-image: url('../src/img/steps/4.png');"></button>
      <button class="slide" onclick="switchSrc(this, 'bean/Frijol_3')"
        style="background-image: url('../src/img/steps/5.png');"></button>
      <button class="slide" onclick="switchSrc(this, 'bean/Frijol_4')"
        style="background-image: url('../src/img/steps/6.png');"></button>
      <button class="slide" onclick="switchSrc(this, 'bean/Frijol_5')"
        style="background-image: url('../src/img/steps/7.png');"></button>
      <button class="slide" onclick="switchSrc(this, 'bean/Frijol_6')"
        style="background-image: url('../src/img/steps/8.png');"></button>
    </div>
  </div>

  <!-- FORMULARIO -->
  <div class="container mt-5">
    <div class="card">
      <div class="text-center mb-4">
        <h4 class="fw-semibold">Predicción de Supervivencia</h4>
        <button id="modalEstandar" class="btn btn-primary btn-round" data-bs-toggle="modal" data-bs-target="#modalTab">
          <i class="bi bi-info-circle"></i>
        </button>
      </div>

      <form id="plant-form" class="mx-auto" style="max-width: 500px;">
        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Temperatura (°C):</label>
          <div class="col-sm-6"><input type="number" id="temperatura" class="form-control" value="20" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Humedad del Suelo (%):</label>
          <div class="col-sm-6"><input type="number" id="humedad_suelo" class="form-control" value="60" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Humedad Ambiente (%):</label>
          <div class="col-sm-6"><input type="number" id="humedad_ambiente" class="form-control" value="60" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Luz (Lux):</label>
          <div class="col-sm-6"><input type="number" id="luz" class="form-control" value="4000" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">pH del Suelo:</label>
          <div class="col-sm-6"><input type="number" id="ph_suelo" class="form-control" value="6" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">CO₂ (ppm):</label>
          <div class="col-sm-6"><input type="number" id="co2" class="form-control" value="400" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Nitrógeno (ppm):</label>
          <div class="col-sm-6"><input type="number" id="nitrogeno" class="form-control" value="20" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Fósforo (ppm):</label>
          <div class="col-sm-6"><input type="number" id="fosforo" class="form-control" value="20" required></div>
        </div>

        <div class="row mb-3">
          <label class="col-sm-6 col-form-label text-end">Potasio (ppm):</label>
          <div class="col-sm-6"><input type="number" id="potasio" class="form-control" value="200" required></div>
        </div>
      </form>

      <div class="text-center">
        <button id="predecirBtn" class="btn btn-outline-primary px-4 mt-3" onclick="predict()">Predecir</button>
        <div id="loading" class="mt-3 text-muted">Cargando...</div>
        <div id="result" class="result"></div>
        <div id="error" class="error text-danger"></div>
      </div>
    </div>
  </div>

  <!-- MODALES -->
  <!-- Modal Tabla de Rangos -->
  <div class="modal fade" id="modalTab" tabindex="-1" aria-labelledby="modalTabLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTabLabel">Tabla de Rangos de Variables</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <table class="table table-striped table-hover align-middle text-center">
            <thead class="table-primary">
              <tr>
                <th>Característica</th>
                <th>Unidad</th>
                <th>Malos</th>
                <th>Estables</th>
                <th>Óptimos</th>
                <th>Nota</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Temperatura</td><td>°C</td><td>10–35</td><td>15–20</td><td>20–30</td><td>Evita extremos térmicos.</td></tr>
              <tr><td>Humedad (Suelo)</td><td>%</td><td>0–50</td><td>50–70</td><td>60–70</td><td>Evita exceso de humedad.</td></tr>
              <tr><td>Humedad (Ambiente)</td><td>%</td><td>0–50</td><td>50–70</td><td>50–70</td><td>Controlar hongos.</td></tr>
              <tr><td>Luz</td><td>Lux</td><td>0–2000</td><td>2000–4000</td><td>4000–8000</td><td>Evitar exceso solar.</td></tr>
              <tr><td>pH del Suelo</td><td>-</td><td>4.0–5.5</td><td>5.5–6.0</td><td>6.0–7.0</td><td>Influye en nutrientes.</td></tr>
              <tr><td>Nutrientes</td><td>ppm</td><td>N: 0–5<br>P: 0–10<br>K: 0–50</td><td>N: 10–20<br>P: 30–60<br>K: 150–250</td><td>N: 20–30<br>P: 40–70<br>K: 200–300</td><td>Evitar deficiencias.</td></tr>
              <tr><td>CO₂</td><td>ppm</td><td>0–300</td><td>300–600</td><td>800–1000</td><td>Buena ventilación.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Recomendación -->
  <div class="modal fade" id="modalResult" tabindex="-1" aria-labelledby="modalResultLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalResultLabel">Recomendación</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div id="resultGPT" class="result"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <footer>
    © 2025 Universidad de San Buenaventura | Proyecto de Predicción de Supervivencia del Frijol
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const modelViewer = document.querySelector("model-viewer");

    window.switchSrc = (el, name) => {
      modelViewer.src = "../src/" + name + ".glb";
      document.querySelectorAll(".slide").forEach(s => s.classList.remove("selected"));
      el.classList.add("selected");
    };

    function redirectToPage() {
      window.location.href = "./plant_detail.html";
    }
  </script>

  <script src="../src/js/codeBackground.js"></script>
  <script src="../src/js/ia.js"></script>

</body>
</html>
