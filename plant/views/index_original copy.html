<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Bootstrap core CSS -->
    <link href="../src/slidebar/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/apple-touch-icon.png" sizes="180x180">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-32x32.png" sizes="32x32" type="image/png">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon-16x16.png" sizes="16x16" type="image/png">
    <link rel="manifest" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/safari-pinned-tab.svg" color="#7952b3">
    <link rel="icon" href="https://getbootstrap.com/docs/5.0/assets/img/favicons/favicon.ico">

    <link rel="stylesheet" href="../src/css/index_invernadero.css">
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

    <link rel="stylesheet" href="../src/slidebar/sidebars.css">
    <script src="../src/slidebar/sidebars.js"></script>

    <script>
       
    </script>

    <title>Puntos de Interés en Modelo 3D</title>
</head>

<body>
    <div class="flex-shrink-0 p-3 bg-white" style="width: 300px;">
        <a href="https://getbootstrap.com/" class="d-flex align-items-center pb-3 mb-3 link-dark text-decoration-none border-bottom">
            <div style="justify-content: top !important;">
                <img style="width: 250px;" src="../src/img/logo_cop_usb.png" alt="Imagen de Encabezado">
            </div>
        </a>
        <ul class="list-unstyled ps-0">
          <li class="mb-1">
            <h5><strong>Prediction</strong></h5>
            <form id="plant-form">
                <label for="temperatura">Temperatura (°C):</label>
                <input type="number" id="temperatura" step="any" value="20" required><br>
        
                <label for="humedad_suelo">Humedad del Suelo (%):</label>
                <input type="number" id="humedad_suelo" step="any" value="60" required><br>
        
                <label for="humedad_ambiente">Humedad Ambiente (%):</label>
                <input type="number" id="humedad_ambiente" step="any" value="60" required><br>
        
                <label for="luz">Luz (Lux):</label>
                <input type="number" id="luz" step="any" value="4000" required><br>
        
                <label for="ph_suelo">pH del Suelo:</label>
                <input type="number" id="ph_suelo" step="any" value="6" required><br>
        
                <label for="co2">CO₂ (ppm):</label>
                <input type="number" id="co2" step="any" value="400" required><br>
        
                <label for="nitrogeno">Nitrógeno (ppm):</label>
                <input type="number" id="nitrogeno" step="any" value="20" required><br>
        
                <label for="fosforo">Fósforo (ppm):</label>
                <input type="number" id="fosforo" step="any" value="20" required><br>
        
                <label for="potasio">Potasio (ppm):</label>
                <input type="number" id="potasio" step="any" value="200" required><br>
            </form>
          </li>
          <li class="border-top my-3"></li>
          <div id="loading">Cargando...</div>
    <div id="result" class="result"></div>
    <div id="error" class="error"></div>

    <h2>Tabla de Rangos de Variables</h2>
    <table>
        <thead>
            <tr>
                <th>Característica</th>
                <th>Unidad</th>
                <th>Malos</th>
                <th>Estables</th>
                <th>Óptimos</th>
                <th>Nota Adicional</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Temperatura</td>
                <td>°C</td>
                <td>10°C a 35°C</td>
                <td>15°C a 20°C</td>
                <td>20°C a 30°C</td>
                <td>Temperaturas extremas pueden afectar el crecimiento y la salud.</td>
            </tr>
            <tr>
                <td>Humedad (Suelo)</td>
                <td>%</td>
                <td>0% a 50%</td>
                <td>50% a 70%</td>
                <td>60% a 70%</td>
                <td>Humedad baja puede causar estrés hídrico; alta puede promover enfermedades.</td>
            </tr>
            <tr>
                <td>Humedad (Ambiente)</td>
                <td>%</td>
                <td>0% a 50%</td>
                <td>50% a 70%</td>
                <td>50% a 70%</td>
                <td>Controlar para evitar enfermedades fúngicas y estrés por sequía.</td>
            </tr>
            <tr>
                <td>Luz (Intensidad)</td>
                <td>Lux</td>
                <td>0 a 2000 lux</td>
                <td>2000 a 4000 lux</td>
                <td>4000 a 8000 lux</td>
                <td>Intensidad insuficiente puede limitar la fotosíntesis; excesiva puede causar daño.</td>
            </tr>
            <tr>
                <td>pH del Suelo</td>
                <td>-</td>
                <td>4.0 a 5.5</td>
                <td>5.5 a 6.0</td>
                <td>6.0 a 7.0</td>
                <td>pH fuera del rango óptimo puede afectar la disponibilidad de nutrientes.</td>
            </tr>
            <tr>
                <td>Contenido de Nutrientes</td>
                <td>ppm (mg/kg)</td>
                <td>N: 0 a 5, P: 0 a 10, K: 0 a 50</td>
                <td>N: 10 a 20, P: 30 a 60, K: 150 a 250</td>
                <td>N: 20 a 30, P: 40 a 70, K: 200 a 300</td>
                <td>Deficiencias o excesos de nutrientes pueden afectar el crecimiento y desarrollo.</td>
            </tr>
            <tr>
                <td>CO₂ (Aire)</td>
                <td>ppm</td>
                <td>0 a 300 ppm</td>
                <td>300 a 600 ppm</td>
                <td>800 a 1000 ppm</td>
                <td>CO₂ >1000 ppm puede causar estrés y reducir el rendimiento. Asegurar ventilación adecuada.</td>
            </tr>
        </tbody>
    </table>

    <script>
        // Asocia la función predict al evento input de cada campo del formulario
        document.querySelectorAll('#plant-form input').forEach(input => {
            input.addEventListener('input', predict);
        });

        async function predict() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').innerHTML = '';
            document.getElementById('error').innerHTML = '';

            const data = {
                temperatura: parseFloat(document.getElementById('temperatura').value),
                humedad_suelo: parseFloat(document.getElementById('humedad_suelo').value),
                humedad_ambiente: parseFloat(document.getElementById('humedad_ambiente').value),
                luz: parseFloat(document.getElementById('luz').value),
                ph_suelo: parseFloat(document.getElementById('ph_suelo').value),
                co2: parseFloat(document.getElementById('co2').value),
                nitrogeno: parseFloat(document.getElementById('nitrogeno').value),
                fosforo: parseFloat(document.getElementById('fosforo').value),
                potasio: parseFloat(document.getElementById('potasio').value)
            };

            try {
                const response = await fetch('http://93.127.213.95:5003/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error('Error en la solicitud');
                }

                const result = await response.json();
                document.getElementById('loading').style.display = 'none';

                document.getElementById('result').innerHTML = `
                    <h2>Resultados:</h2>
                    <p><strong>Porcentaje de Supervivencia Predicho:</strong> ${result.prediction_result['Porcentaje de Supervivencia Predicho']}</p>
                    <p><strong>Estado de Vida Predicho:</strong> ${result.prediction_result['Estado de Vida Predicho']}</p>
                    <h3>Estado de Variables:</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Característica</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(result.prediction_result['Estado de Variables']).map(([key, value]) => `
                                <tr>
                                    <td>${key.charAt(0).toUpperCase() + key.slice(1)}</td>
                                    <td>${value}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    <h3>Recomendación GPT-4:</h3>
                    <p>${result.gpt_response}</p>
                `;
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').innerHTML = 'Ocurrió un error. Inténtalo de nuevo más tarde.';
                console.error('Error:', error);
            }
        }
    </script>

        </ul>
      </div>

    <!--<model-viewer id="plantViewer" src="../src/Farm/farm.glb" alt="A 3D model of a plant" camera-controls ar
        ar-modes="webxr scene-viewer quick-look" exposure="0.3" shadow-intensity="0.5" shadow-softness="1">
        <button class="annotation" slot="hotspot-1" data-position="0.5m 2.5m 0.5m" data-normal="-0.73 0.05 0.69">1</button>
    </model-viewer>-->

    <div class="info-panel" id="infoPanel">
        <span class="close" id="closeModal">&times;</span>
        <h2>Información de la Planta</h2>
        <p id="infoContent">Selecciona un punto de interés para más detalles.</p>
        <button id="videoButton">Ver Video</button>
    </div>

    <div id="videoModal" class="modal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <iframe id="youtubeVideo" width="560" height="315" src="" frameborder="0" allowfullscreen></iframe>
        </div>
    </div>

    <script>
        const infoPanel = document.getElementById('infoPanel');
        const infoContent = document.getElementById('infoContent');
        const videoButton = document.getElementById('videoButton');
        const videoModal = document.getElementById('videoModal');
        const closeModal = document.getElementById('closeModal');
        const youtubeVideo = document.getElementById('youtubeVideo');

        document.querySelectorAll('.annotation').forEach((annotation) => {
            annotation.addEventListener('click', () => {
                const content = getInfoContent(annotation.textContent);
                infoContent.textContent = content;
                infoPanel.style.display = 'block';
            });
        });

        videoButton.addEventListener('click', () => {
            youtubeVideo.src = "https://www.youtube.com/embed/vyeiYBfm_kg?si=v8JB5f4HzLZdhR5N"; // Reemplaza "your-video-id" con el ID de tu video de YouTube
            videoModal.style.display = "block";
        });

        closeModal.addEventListener('click', () => {
            videoModal.style.display = "none";
            infoPanel.style.display = "none";
            youtubeVideo.src = ""; // Detener el video al cerrar el modal
        });

        window.addEventListener('click', (event) => {
            if (event.target === videoModal) {
                videoModal.style.display = "none";
                youtubeVideo.src = ""; // Detener el video al hacer clic fuera del modal
            }
        });

        function getInfoContent(annotationId) {
            switch (annotationId) {
                case '1':
                    return 'Humedad: 65%, Probabilidad de vivir: 80%, Factores: Luz solar moderada.';
                case '2':
                    return 'Humedad: 70%, Probabilidad de vivir: 85%, Factores: Riego adecuado.';
                case '3':
                    return 'Humedad: 60%, Probabilidad de vivir: 75%, Factores: Fertilización adecuada.';
                default:
                    return 'Selecciona un punto de interés para más detalles.';
            }
        }
    </script>
</body>

</html>